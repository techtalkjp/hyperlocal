# Hyperlocal Web アプリケーション UI/UX 評価レポート

## 評価の目的

Hyperlocal のパブリック Web アプリケーションが、新たに策定したデザインポリシーの原則に沿って構築されているかを検証する。このレポートでは、現状の実装を分析し、ユーザー体験を向上させるための具体的な改善点を提示する。

## 評価対象

apps/web ディレクトリ配下のパブリック Web アプリケーション全体を対象とした。主要な画面として、エリア一覧、カテゴリー別店舗リスト、店舗詳細ページ、言語切り替え、近隣エリア選択の各機能について評価を実施した。

## デザインポリシーの評価基準

評価は以下の4つの原則に基づいて実施した。

第一に「操作がブロックされない」では、ユーザーの操作を必要以上に制限せず、処理中でも他の操作を許可し、モーダルの使用を最小限に抑えているかを確認した。

第二に「操作に対してすぐにフィードバックがある」では、ユーザーの操作が受け付けられたことを即座に示し、ローディング状態を明確に表示し、表示速度を最適化しているかを検証した。

第三に「すぐに元の状態に戻れる」では、前の画面への導線が明確で、スクロール位置や入力内容が適切に保持され、UI パターンの選択が適切かを評価した。

第四に「操作の予測可能性」では、一貫性のある UI、明確なラベリング、視覚的なヒント、破壊的操作への適切な警告があるかを確認した。

## 現状の実装における優れた点

現在の実装には、デザインポリシーに沿った優れた実装がいくつか確認できた。

まず、React Router v7 の ScrollRestoration が root.tsx で適切に実装されており、ページ遷移後に元のスクロール位置に戻る機能が実現されている。これは「すぐに元の状態に戻れる」という原則を満たす重要な実装である。

次に、viewTransition プロパティが広範囲で活用されており、ページ遷移時のスムーズなアニメーションが実装されている。特に area.$area.$category/route.tsx では viewTransitionName を使用して、エリアタイトルやカテゴリーナビゲーションの要素が遷移前後で視覚的に連続している。これにより、ユーザーは画面遷移が起こったことを自然に理解できる。

また、prefetch 機能が効果的に使用されている。"viewport" や "intent" といった prefetch 戦略により、ユーザーがリンクをクリックする前にデータを先読みすることで、体感速度が向上している。これは「操作に対してすぐにフィードバックがある」という原則に合致する。

さらに、area.$area.$category.$rank/route.tsx では、タブ切り替え時にローディングインジケーターが表示される実装がある。isPending を使用して "Near Me" タブの読み込み中にスピナーを表示することで、ユーザーに処理状況を明確に伝えている。

近隣エリア選択の実装も評価できる。nearby-areas/route.tsx では、ドロップダウンを開いた時点で位置情報の取得を開始し、その間ローディング状態を表示する。位置情報の取得に失敗した場合はエラーメッセージを表示し、ユーザーに状況を明確に伝えている。

## 改善が必要な点

一方で、デザインポリシーの観点から改善が望ましい点も複数確認された。

### スクロール位置の保持に関する課題

place.$place/route.tsx の店舗詳細ページから "Back to List" ボタンでリストページに戻る際、スクロール位置が保持されない可能性がある。React Router の ScrollRestoration は基本的に browser の戻るボタンに対応しているが、Link コンポーネントによる遷移では同じスクロール位置に戻ることが保証されない。

これは「すぐに元の状態に戻れる」という原則に反している。ユーザーはリストを下の方まで見て店舗詳細を開いたのに、戻った時にリストの先頭に戻ってしまうと、どこまで見たかを見失ってしまう。Twitter のタイムラインと同様、詳細から戻った時に同じ位置に戻れることが望ましい。

### 言語切り替えの課題

language-select.tsx における言語切り替えは、現在の URL から言語部分を置き換える実装となっている。しかし、言語切り替え時に現在のスクロール位置が失われる可能性がある。また、ドロップダウンメニューの項目として実装されているため、キーボード操作やスクリーンリーダーでのアクセシビリティに配慮が必要である。

さらに、言語切り替え後のページが存在しない場合のフォールバック処理が明示的に実装されていない。ユーザーが言語を切り替えた結果、404 エラーに遭遇するのは良いユーザー体験とは言えない。

### ローディング状態の一貫性

一部の画面ではローディングインジケーターが表示されるが、すべての非同期処理に対して一貫したフィードバックが提供されているわけではない。例えば、nearby-areas/route.tsx ではローディング状態が表示されるが、通常のページ遷移時のローディング状態は PageLoadingProgress に依存しており、視覚的なフィードバックの統一性に欠ける部分がある。

「操作に対してすぐにフィードバックがある」という原則を徹底するためには、すべての非同期処理に対して一貫したローディングフィードバックを提供することが望ましい。

### エラーハンドリングの課題

nearby-areas/route.tsx では位置情報取得失敗時のエラーメッセージが表示されるが、他の箇所でのエラーハンドリングは必ずしも明示的でない。特に、ネットワークエラーやサーバーエラーが発生した場合に、ユーザーに何が起こったのか、どうすれば良いのかを明確に伝える実装が不足している。

エラーが発生したことをユーザーに伝え、可能であれば回復手段を提示することで、「操作に対してすぐにフィードバックがある」という原則をより強化できる。

### 戻る導線の明示性

place.$place/route.tsx では、リストページから遷移してきた場合のみ "Back to List" ボタンが表示される実装となっている。これは適切な判断だが、直接 URL でアクセスした場合には戻る導線が提供されない。ブラウザの戻るボタンに依存することになるが、より明示的なナビゲーション要素があると親切である。

### キャンセル可能性の欠如

近隣エリア検索で位置情報の取得を開始すると、キャンセルする手段が提供されていない。位置情報の取得に時間がかかる場合や、ユーザーが「やっぱりやめた」と思った場合に、ドロップダウンを閉じること以外の明示的なキャンセル手段がない。

「操作がブロックされない」という原則を徹底するためには、時間のかかる操作にはキャンセルボタンを提供することが望ましい。

## 推奨する改善策

これらの課題に対して、以下の改善策を推奨する。

### スクロール位置の保持

店舗リストページでの現在のスクロール位置を sessionStorage に保存し、詳細ページから戻った際に復元する実装を追加する。React Router の useLocation と useEffect を組み合わせることで実現できる。ただし、useEffect はスクロール位置の同期という外部リソースとの連携に使用するため、デザインポリシーの useEffect Policy に沿った使用となる。

### 言語切り替えの改善

言語切り替え時に現在のスクロール位置を URL の hash パラメータとして保存し、遷移後に復元する。また、切り替え先のページが存在しない場合は、その言語のトップページにフォールバックする処理を追加する。さらに、ARIA ラベルを適切に設定し、キーボード操作とスクリーンリーダーでのアクセシビリティを向上させる。

### ローディング状態の統一

すべての非同期操作に対して、一貫したローディングフィードバックを提供する。現在の PageLoadingProgress に加えて、個別のコンポーネント内での処理に対しても適切なインジケーターを表示する。特に、データ取得中は Skeleton UI を使用することで、レイアウトシフトを防ぎつつ、表示できる部分から順次表示できる。

### エラーハンドリングの強化

React Router のエラーバウンダリーを活用し、エラー発生時にユーザーフレンドリーなメッセージを表示する。可能な場合は「再試行」ボタンを提供し、ユーザーが自力で回復できるようにする。また、ネットワークエラーとサーバーエラーを区別し、それぞれに適したメッセージを表示する。

### ナビゲーションの改善

店舗詳細ページに、常にエリア選択ページへの戻るリンクを表示する。パンくずリストは既に実装されているが、より目立つ位置に配置するか、戻るボタンを常時表示することで、ユーザーがどこからでもナビゲーション階層を把握しやすくなる。

### キャンセル機能の追加

位置情報取得中にドロップダウン内に「キャンセル」ボタンを表示し、ユーザーが明示的に操作を中断できるようにする。これにより、位置情報の取得が遅い場合でもユーザーは他の操作に移行できる。

## 総合評価

Hyperlocal の Web アプリケーションは、デザインポリシーの多くの原則を既に実現している。特に、View Transitions による滑らかな画面遷移、prefetch による高速な体感速度、部分的なローディング状態の表示など、優れた UX 実装が確認できた。

一方で、スクロール位置の保持、エラーハンドリング、キャンセル可能性といった点で改善の余地がある。これらは、ユーザーが「なんか使いづらい」と感じる要因となりうる。

推奨する改善策を実施することで、デザインポリシーで掲げた「操作がブロックされない」「操作に対してすぐにフィードバックがある」「すぐに元の状態に戻れる」「操作の予測可能性」という4つの原則をより徹底し、ユーザーにとって本当に使いやすいアプリケーションを実現できる。

優先度としては、スクロール位置の保持とエラーハンドリングの強化が最も重要である。これらは直接的にユーザーの満足度に影響するためである。その次に、ローディング状態の統一とナビゲーションの改善に取り組むことを推奨する。
