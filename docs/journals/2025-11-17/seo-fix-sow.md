# SEO修正タスク - 作業範囲定義書

## 目的

Google検索のインデックスに復帰するため、調査で発見された技術的問題を修正します。最小限のコード変更で最大の効果を得ることを目指し、段階的にリリースします。

## 対応方針

robots.txtブロック事故によりGoogleの信頼を失っている状況で、さらにlocalhost URLなどの技術的問題が発見されました。Googleに「このサイトは適切に管理されている」というシグナルを送るため、確実に動作する修正を段階的にデプロイし、その都度Search Consoleで再インデックスをリクエストします。

## Phase 1: 緊急修正（最優先）

### タスク1-1: 構造化データのlocalhost URL修正

**目的**: JSON-LD構造化データ内のURLフィールドがlocalhostを指している致命的なバグを修正します。

**現状の問題**:
カテゴリー一覧ページの構造化データで、URLがlocalhost になっています。

```typescript
url: new URL(
  `${data.lang.path}area/${data.area.areaId}/${data.category.id}/${data.rankingType}`,
  data.url,  // これが原因
).toString(),
```

**修正内容**:
既存の generateCanonicalUrl 関数と同じロジックを使用します。

対象ファイル: `apps/web/app/routes/_public.($lang)+/area.$area.$category.$rank/route.tsx`

修正箇所: meta 関数内の JSON-LD 生成部分、1箇所のみ

**期待される効果**:
Googleが構造化データを信頼し、LocalBusinessスキーマを正しく認識するようになります。過去のrobots.txt事故と合わせて信頼性を損なっていた最大の問題が解消されます。

**リスク**: なし。既存のカノニカルURL生成ロジックと同じ実装を使うため安全です。

---

### タスク1-2: トップページのmeta description追加

**目的**: トップページに適切な説明文を追加し、Googleがページの目的を理解できるようにします。

**現状の問題**:
root.tsx で description は "Hyperlocal" という単語のみです。これではページの内容が伝わりません。

**修正内容**:
対象ファイル: `apps/web/app/root.tsx`

meta 関数で、各言語に対応した適切な description を設定します。既存の lang データを使用して、言語ごとに最適化された説明文を生成します。

**期待される効果**:
Googleがトップページの目的と価値を理解し、インデックス登録の判断材料を得られます。

**リスク**: なし。meta タグの追加のみで、既存機能に影響しません。

---

### タスク1-3: エリアインデックスページのmeta description追加

**目的**: 各エリアページに説明文を追加し、Googleがページ内容を理解できるようにします。

**現状の問題**:
エリアページ（例: /area/marunouchi）には description メタタグがありません。コンテンツ内には area.description があるのに、メタタグとして出力していません。

**修正内容**:
対象ファイル: `apps/web/app/routes/_public.($lang)+/area.$area._index/route.tsx`

meta 関数に description を追加します。既存の area.description を活用できるため、コンテンツの追加は不要です。

**期待される効果**:
20のエリアページすべてに適切な説明文が付与され、Googleがページの価値を理解できます。

**リスク**: なし。既存データを使用するため、新規コンテンツ作成は不要です。

---

### タスク1-4: トップページ（言語別）のmeta description追加

**目的**: 言語別トップページに説明文を追加します。

**現状の問題**:
_index ルートにも適切な description がありません。

**修正内容**:
対象ファイル: `apps/web/app/routes/_public.($lang)+/_index/route.tsx`

meta 関数に、各言語に最適化された description を追加します。

**期待される効果**:
多言語対応のトップページすべてに説明文が付与されます。

**リスク**: なし。

---

## Phase 1 の実装順序

1. localhost URL修正（タスク1-1）を最優先で実装
2. デプロイ後、主要ページをSearch Consoleで再インデックスリクエスト
3. meta description追加（タスク1-2, 1-3, 1-4）を実装
4. デプロイ後、再度インデックスリクエスト

各ステップで動作確認を行い、問題がないことを確認してから次に進みます。

## Phase 2: 中期対応（Phase 1完了後に検討）

### タスク2-1: 店舗詳細ページの構造化データ追加

**目的**: 個別店舗ページにRestaurantスキーマを追加します。

**実装内容**:
対象ファイル: `apps/web/app/routes/_public.($lang)+/place.$place/route.tsx`

JSON-LDでRestaurantまたはLocalBusinessスキーマを追加します。必要な情報は既にデータベースにあるため、ローダーから取得したplaceデータを構造化データに変換します。

**期待される効果**:
Googleが個別店舗を理解し、ローカル検索機能（マップ、ナレッジパネル）で表示される可能性が高まります。

**コード変更**: meta 関数に JSON-LD スキーマを追加。中規模の変更です。

---

### タスク2-2: Open Graph メタデータ追加

**目的**: SNSシェア時の表示を最適化し、ソーシャルシグナルを向上させます。

**実装内容**:
主要ルートファイルの meta 関数に og:title, og:description, og:image を追加します。

ヘルパー関数 generateOpenGraphTags を作成し、各ページで再利用します。

**期待される効果**:
SNSでシェアされた際の表示が改善され、クリック率が向上します。間接的にSEOにも好影響があります。

**コード変更**: 複数ファイルですが、ヘルパー関数を作れば各ページは数行の追加で済みます。

---

## Phase 3: 長期対応（コンテンツ強化）

### タスク3-1: エリアページのコンテンツ拡充

これは技術的修正ではなく、コンテンツ作成タスクです。Phase 1と2の効果を確認してから検討します。

### タスク3-2: トレイリングスラッシュの整合性確保

現状、/area/marunouchi と /area/marunouchi/ の両方がアクセス可能です。React Routerの設定で統一することを検討します。ただし、canonical タグで対応済みなので優先度は低いです。

---

## 成果指標

各フェーズ完了後、以下を確認します：

1. Search Consoleでインデックス登録されたページ数の変化
2. カバレッジレポートでのエラー数
3. 検索パフォーマンスでの表示回数とクリック数

Phase 1完了後、2週間程度でGoogleの再クロールとインデックス評価を待ちます。改善が見られたらPhase 2に進みます。

---

## リスク管理

すべての変更はSSRに影響する可能性があるため、デプロイ前にローカルで動作確認を行います。特に：

- ビルドエラーが発生しないこと
- meta タグが正しく出力されること
- 既存の機能が壊れていないこと

段階的リリースにより、問題が発生した場合の影響を最小化します。
